<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce Database ERD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .diagram-container {
            padding: 40px;
            background: white;
            overflow-x: auto;
        }
        
        .mermaid {
            text-align: center;
        }
        
        .controls {
            padding: 20px 40px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            text-align: center;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõçÔ∏è E-commerce Platform</h1>
            <p>Database Entity Relationship Diagram</p>
        </div>
        
        <div class="diagram-container">
            <div class="info">
                <strong>üìä Database Overview:</strong> Bu diagram 21 ta asosiy jadval va ularning o'rtasidagi bog'lanishlarni ko'rsatadi. 
                E-commerce platformasining to'liq ma'lumotlar bazasi strukturasi.
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number">21</div>
                    <div class="stat-label">Jadvallar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">150+</div>
                    <div class="stat-label">Ustunlar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">25+</div>
                    <div class="stat-label">Bog'lanishlar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">3</div>
                    <div class="stat-label">Ko'p tillilik</div>
                </div>
            </div>
            
            <div class="mermaid">
erDiagram
    %% Users va Authentication
    users {
        bigint id PK
        string name
        string email UK
        string phone
        timestamp phone_verified_at
        string password
        string avatar
        text address
        bigint city_id FK
        enum role "customer,seller,admin"
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }

    %% Addresses
    addresses {
        bigint id PK
        bigint user_id FK
        string title
        text address
        bigint city_id FK
        string district
        string landmark
        string phone
        decimal latitude
        decimal longitude
        boolean is_default
        timestamp created_at
        timestamp updated_at
    }

    %% Cities
    cities {
        bigint id PK
        boolean is_active
        boolean delivery_available
        decimal delivery_fee
        timestamp created_at
        timestamp updated_at
    }

    %% Languages
    languages {
        bigint id PK
        string code UK
        string name
        string native_name
        boolean is_active
        boolean is_default
        int sort_order
        timestamp created_at
        timestamp updated_at
    }

    %% Translations
    translations {
        bigint id PK
        string translatable_type
        string translatable_id
        string language_code FK
        string field
        text value
        timestamp created_at
        timestamp updated_at
    }

    %% Categories
    categories {
        bigint id PK
        bigint parent_id FK
        string image
        int sort_order
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }

    %% Products
    products {
        bigint id PK
        bigint seller_id FK
        bigint category_id FK
        decimal price
        decimal discount_price
        string unit
        int stock_quantity
        int min_order_quantity
        string sku UK
        string barcode
        decimal weight
        json dimensions
        boolean is_featured
        boolean is_active
        int views_count
        decimal rating_average
        int rating_count
        int rating_1_star
        int rating_2_star
        int rating_3_star
        int rating_4_star
        int rating_5_star
        int reviews_count
        int verified_reviews_count
        timestamp created_at
        timestamp updated_at
    }

    %% Product Images
    product_images {
        bigint id PK
        bigint product_id FK
        string image_path
        string alt_text
        boolean is_primary
        int sort_order
        int file_size
        string mime_type
        timestamp created_at
        timestamp updated_at
    }

    %% Product Variants
    product_variants {
        bigint id PK
        bigint product_id FK
        string name
        string sku UK
        decimal price
        int stock_quantity
        decimal weight
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }

    %% Product Variant Attributes
    product_variant_attributes {
        bigint id PK
        bigint product_variant_id FK
        string attribute_name
        string attribute_value
        timestamp created_at
        timestamp updated_at
    }

    %% Shopping Cart
    carts {
        bigint id PK
        bigint user_id FK
        bigint product_id FK
        int quantity
        string session_id
        timestamp created_at
        timestamp updated_at
    }

    %% Wishlist
    wishlists {
        bigint id PK
        bigint user_id FK
        bigint product_id FK
        timestamp created_at
        timestamp updated_at
    }

    %% Orders
    orders {
        bigint id PK
        string order_number UK
        bigint user_id FK
        enum status "pending,confirmed,processing,shipped,delivered,cancelled"
        decimal subtotal
        decimal delivery_fee
        decimal discount_amount
        decimal total_amount
        enum payment_method "cash,card,transfer"
        enum payment_status "pending,paid,failed,refunded"
        json delivery_address
        bigint delivery_city_id FK
        date delivery_date
        string delivery_time_slot
        text notes
        text cancellation_reason
        timestamp confirmed_at
        timestamp shipped_at
        timestamp delivered_at
        timestamp cancelled_at
        timestamp created_at
        timestamp updated_at
    }

    %% Order Items
    order_items {
        bigint id PK
        bigint order_id FK
        bigint product_id FK
        string product_name
        string product_sku
        int quantity
        decimal unit_price
        decimal total_price
        timestamp created_at
        timestamp updated_at
    }

    %% Reviews
    reviews {
        bigint id PK
        bigint user_id FK
        bigint product_id FK
        bigint order_id FK
        int rating
        text comment
        json pros
        json cons
        boolean is_approved
        boolean is_verified_purchase
        timestamp approved_at
        string admin_comment
        int helpful_count
        int not_helpful_count
        timestamp created_at
        timestamp updated_at
    }

    %% Review Images
    review_images {
        bigint id PK
        bigint review_id FK
        string image_path
        string original_name
        int file_size
        string mime_type
        int sort_order
        timestamp created_at
        timestamp updated_at
    }

    %% Review Helpfulness
    review_helpfulness {
        bigint id PK
        bigint review_id FK
        bigint user_id FK
        boolean is_helpful
        timestamp created_at
        timestamp updated_at
    }

    %% Coupons
    coupons {
        bigint id PK
        string code UK
        enum type "percentage,fixed"
        decimal value
        decimal minimum_amount
        decimal maximum_discount
        int usage_limit
        int used_count
        timestamp starts_at
        timestamp expires_at
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }

    %% Banners
    banners {
        bigint id PK
        string title
        text description
        string image
        string link_url
        string button_text
        enum position "hero,sidebar,footer"
        int sort_order
        timestamp starts_at
        timestamp expires_at
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }

    %% Notifications
    notifications {
        bigint id PK
        bigint user_id FK
        enum type "order,product,system,promotional"
        string title
        text message
        json data
        string action_url
        timestamp read_at
        timestamp created_at
        timestamp updated_at
    }

    %% Settings
    settings {
        bigint id PK
        string key UK
        text value
        enum type "string,integer,boolean,float,json"
        string group
        timestamp created_at
        timestamp updated_at
    }

    %% Relationships
    users ||--o{ addresses : "has many"
    users ||--o{ orders : "places"
    users ||--o{ carts : "has items"
    users ||--o{ wishlists : "has wishlist"
    users ||--o{ reviews : "writes"
    users ||--o{ notifications : "receives"
    users ||--o{ review_helpfulness : "votes"
    users ||--o{ products : "sells"

    cities ||--o{ users : "located in"
    cities ||--o{ addresses : "delivery to"
    cities ||--o{ orders : "delivered to"

    languages ||--o{ translations : "has translations"

    categories ||--o{ categories : "parent-child"
    categories ||--o{ products : "contains"

    products ||--o{ product_images : "has images"
    products ||--o{ product_variants : "has variants"
    products ||--o{ carts : "added to cart"
    products ||--o{ wishlists : "added to wishlist"
    products ||--o{ order_items : "ordered"
    products ||--o{ reviews : "reviewed"

    product_variants ||--o{ product_variant_attributes : "has attributes"

    orders ||--o{ order_items : "contains"

    reviews ||--o{ review_images : "has images"
    reviews ||--o{ review_helpfulness : "voted on"

    translations }o--|| languages : "in language"
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="window.print()">üñ®Ô∏è Print</button>
            <button class="btn" onclick="exportSVG()">üíæ Export SVG</button>
            <button class="btn" onclick="zoomIn()">üîç Zoom In</button>
            <button class="btn" onclick="zoomOut()">üîç Zoom Out</button>
        </div>
    </div>

    <script>
        // Mermaid ni initialize qilish
        mermaid.initialize({
            theme: 'default',
            startOnLoad: true,
            er: {
                fontSize: 12,
                useMaxWidth: true
            }
        });

        function exportSVG() {
            const svg = document.querySelector('.mermaid svg');
            if (svg) {
                const serializer = new XMLSerializer();
                const source = serializer.serializeToString(svg);
                const blob = new Blob([source], {type: 'image/svg+xml;charset=utf-8'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'ecommerce-erd.svg';
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        function zoomIn() {
            const diagram = document.querySelector('.mermaid');
            const currentScale = diagram.style.transform ? 
                parseFloat(diagram.style.transform.match(/scale\((.*?)\)/)?.[1] || 1) : 1;
            diagram.style.transform = `scale(${currentScale * 1.2})`;
        }

        function zoomOut() {
            const diagram = document.querySelector('.mermaid');
            const currentScale = diagram.style.transform ? 
                parseFloat(diagram.style.transform.match(/scale\((.*?)\)/)?.[1] || 1) : 1;
            diagram.style.transform = `scale(${currentScale * 0.8})`;
        }
    </script>
</body>
</html>